@{
    ViewData["Title"] = "Cozy Homes - Tenants";
    Layout = "~/Views/Shared/_LayoutPM.cshtml";
}
@model List<PMS.Models.TenantViewModel>

@if (TempData["ShowPopup"] != null && (bool)TempData["ShowPopup"])
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: '@TempData["PopupTitle"]',  // Set the title dynamically
                text: '@TempData["PopupMessage"]', // Set the message dynamically
                icon: '@TempData["PopupIcon"]',    // Set the icon dynamically (success, error, warning, info)
                confirmButtonText: 'OK'
            });
        });
    </script>
}

<div class="tenants-page">
    <h1>Tenants Management</h1>
    @* <button asp-controller="PropertyManager" asp-action="AddTenant" class="pay-button">Add New Tenant</button> *@
    @* <button class="button" onclick="exportToCSV()">Export to CSV</button> *@
    @* <button class="pay-button" onclick="exportToPDF()">Export to PDF</button> *@
    <div class="units-list-header">
        <h2>Tenants</h2>
        @* <a id="addTenantBtn" style="text-decoration: none;background-color: white;color: #B0836E;padding: 10px 20px;border-radius: 10px; font-weight: 600; cursor: pointer;">Add Tenant</a> *@
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search...">
        <button class="search-button" onclick="searchTable()"><i class="fas fa-search"></i></button>
        <button class="search-button" onclick="exportToPDF()">Export to PDF</button>
        <button class="search-button" onclick="exportToCSV()">Export to CSV</button>

    </div>


    <table class="tenants-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Tenant Name</th>
                @* <th>Unit</th> *@
                <th>Email</th>
                @* <th>Lease Status</th> *@
                @* <th>Payment Status</th> *@

                @* <th>Lease Start Date</th> *@
                @* <th>Lease End Date</th> *@
                @* <th>Monthly Rent</th> *@
                @* <th>Outstanding Balance</th> *@
                @* <th>Status</th> *@
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>

            @if (Model != null && Model.Any())
            {
                int index = 1;
                foreach (var tenant in Model)
                {
                    <tr>
                        <td>@index</td>
                        <td>@tenant.TenantName</td>
                        @* <td>@tenant.UnitName</td> *@
                        <td>@tenant.Email</td><!--tenant.PhoneNumber --> 
                        @* <td>@tenant.LeaseStatus</td> *@
                        @* <td>@tenant.PaymentStatus</td> *@

                        @* <td> *@
                        @*     @tenant.IsActive *@
                        @*     <select> *@
                        @*         <option value="active">Active</option> *@
                        @*         <option value="inactive">Inactive</option> *@
                        @*     </select> *@
                        @* </td> *@
                        <td class="action-icons">
                            @* <a asp-action="UpdateTenant" asp-route-id="@tenant.TenantID" title="Edit" style="font-size: 20px;"><i class="fas fa-edit edit"></i></a> *@
                            <!-- Form for deleting the unit -->
                            <form asp-action="DeleteTenant" asp-route-id="@tenant.TenantID" method="post" style="display:inline;">
                                <button type="submit" title="Delete" style="background: none; border: none; padding: 0; width: fit-content; height: fit-content;">
                                    <i class="fas fa-trash delete" style="font-size: 20px;"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    index++;
                }
            }
            else
            {
                <tr>
                    <td colspan="5" style="text-align:center;">No tenants found.</td>
                </tr>
            }
            @* <tr> *@
           
        </tbody>
    </table>
</div>
<div class="pagination" style="margin: 20px 0 200px;">
    <button>Previous</button>
    <button style="margin: 0 0 0 5px;">Next</button>
</div>


<!-- Modal structure -->
<div class="modal" id="tenantModal" tabindex="-1" aria-labelledby="tenantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tenantModalLabel">Tenant Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="tenantDetails">Loading...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



    <!-- Confirmation Modal for Deletion -->
<div id="confirmationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
    <div style="background-color: white; padding: 20px; border-radius: 10px; width: 400px; text-align: center;">
        <h3>Are you sure you want to delete this tenant?</h3>
        <button id="confirmDeleteBtn" style="background-color: #4CAF50; color: white; padding: 10px 20px; border-radius: 5px;">Yes</button>
        <button onclick="document.getElementById('confirmationModal').style.display='none'" style="background-color: #f44336; color: white; padding: 10px 20px; border-radius: 5px; margin-left: 10px;">No</button>
    </div>
</div>

<script>
   

     // Search Functionality
    function searchTable() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('.tenants-table tbody tr');

        rows.forEach(row => {
            const tenantName = row.cells[1].innerText.toLowerCase(); // Assuming name is in the second column
            if (tenantName.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    // Export to CSV Functionality
    function exportToCSV() {
        const table = document.querySelector('.tenants-table');
        const rows = Array.from(table.rows);

        const csvContent = rows.map(row => {
            const cells = Array.from(row.cells).map(cell => cell.innerText);
            return cells.join(',');
        }).join('\n');

        const csvBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(csvBlob);
        downloadLink.download = 'tenants.csv';
        downloadLink.click();
    }

    // Export to PDF Functionality
    function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const table = document.querySelector('.tenants-table');

        const rows = Array.from(table.rows).map(row => {
            return Array.from(row.cells).map(cell => cell.innerText);
        });

        const headers = rows.shift(); // Remove the header row

        doc.autoTable({
            head: [headers],
            body: rows,
            startY: 20,
            margin: { horizontal: 10 },
        });

        doc.save('tenants.pdf');
    }

    // Event listener for 'Enter' key to trigger search
    document.getElementById('searchInput').addEventListener('keyup', searchTable);

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>



@* <!-- Script to load tenant details --> *@
@* <script> *@
@*     function viewTenantDetails(tenantId) { *@
@*         fetch(`/PropertyManager/ViewTenantDetails/${tenantId}`) *@
@*             .then(response => response.json()) *@
@*             .then(data => { *@
@*                 const details = ` *@
@*                     <strong>Name:</strong> ${data.name}<br> *@
@*                     <strong>Unit:</strong> ${data.unit}<br> *@
@*                     <strong>Lease Start:</strong> ${data.leaseStartDate}<br> *@
@*                     <strong>Lease End:</strong> ${data.leaseEndDate}<br> *@
@*                     <strong>Status:</strong> ${data.status} *@
@*                 `; *@
@*                 document.getElementById('tenantDetails').innerHTML = details; *@
@*                 const modal = new bootstrap.Modal(document.getElementById('tenantModal')); *@
@*                 modal.show(); *@
@*             }) *@
@*             .catch(error => console.error('Error loading tenant details:', error)); *@
@*     } *@
@* </script> *@


